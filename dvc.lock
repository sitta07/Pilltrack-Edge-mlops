schema: '2.0'
stages:
  train:
    cmd: python src/training/train.py
    deps:
    - path: data/pills_dataset_resnet.zip
      hash: md5
      md5: afc658f9360f9f008a3bda6ecf8fdf52
      size: 147818896
    - path: src/training/train.py
      hash: md5
      md5: 3797fc188f7d8b2d94d282273308272a
      size: 11877
    params:
      params.yaml:
        data.extract_path: data/raw
        model.num_classes: 46
        train.alpha: 0.2078451089181085
        train.batch_size: 32
        train.epochs: 2
        train.lr: 0.0003682779964048965
        train.temperature: 5.971135416355251
    outs:
    - path: models/best_student.pth
      hash: md5
      md5: 8b7411f882239de29937be4b1f261bea
      size: 9373003
  convert:
    cmd: python src/conversion/convert.py
    deps:
    - path: models/best_student.pth
      hash: md5
      md5: 8b7411f882239de29937be4b1f261bea
      size: 9373003
    - path: src/conversion/convert.py
      hash: md5
      md5: c5f2e662b8463aa3a0471918c8ab79ce
      size: 9663
    params:
      params.yaml:
        data.extract_path: data/raw
        evaluation.min_accuracy: 85.0
    outs:
    - path: models/student_quant_int8.tflite
      hash: md5
      md5: e64ae75a8966ce99d96faa9f73935fd4
      size: 2770392
  enroll:
    cmd: python src/enrollment/enroll.py
    deps:
    - path: data/raw
      hash: md5
      md5: fe2b3cdaaa4dec0f52e84ec41525004d.dir
      size: 156502338
      nfiles: 19718
    - path: models/student_quant_int8.tflite
      hash: md5
      md5: e64ae75a8966ce99d96faa9f73935fd4
      size: 2770392
    - path: src/enrollment/enroll.py
      hash: md5
      md5: fa83fefeec3451124211afb856ae3d84
      size: 5363
    params:
      params.yaml:
        enrollment.s3_prefix: production/edge-models/v1/
    outs:
    - path: models/labels.json
      hash: md5
      md5: 2d431afa2ec2451df8af92f6c0d1b9b2
      size: 28682
    - path: models/pill_db.index
      hash: md5
      md5: c95706bfbd1e888b15f397026796dbe0
      size: 253965
  validate:
    cmd: python src/validate.py
    deps:
    - path: data/raw/pills_dataset_resnet/test
      hash: md5
      md5: f6d85b333af7f2f1b5815bb72f493563.dir
      size: 23772179
      nfiles: 1510
    - path: models/pill_db.index
      hash: md5
      md5: c95706bfbd1e888b15f397026796dbe0
      size: 253965
    - path: models/student_quant_int8.tflite
      hash: md5
      md5: e64ae75a8966ce99d96faa9f73935fd4
      size: 2770392
    - path: src/validate.py
      hash: md5
      md5: 118d2fdc9cd2cc08c2bd97d63f9a03cc
      size: 5132
    outs:
    - path: metrics.json
      hash: md5
      md5: a33e41c1dd341ba7ca1e9f18cec253cc
      size: 38
  prepare:
    cmd: python src/prepare.py
    deps:
    - path: data/pills_dataset_resnet.zip
      hash: md5
      md5: afc658f9360f9f008a3bda6ecf8fdf52
      size: 147818896
    - path: src/prepare.py
      hash: md5
      md5: 673ef739126a64b910df50e43c5649eb
      size: 1117
    outs:
    - path: data/raw
      hash: md5
      md5: fe2b3cdaaa4dec0f52e84ec41525004d.dir
      size: 156502338
      nfiles: 19718
