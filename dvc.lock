schema: '2.0'
stages:
  train:
    cmd: python src/training/train.py
    deps:
    - path: data/pills_dataset_resnet.zip
      hash: md5
      md5: afc658f9360f9f008a3bda6ecf8fdf52
      size: 147818896
    - path: src/training/train.py
      hash: md5
      md5: 36b55fc04715ee46970958259faf81b0
      size: 11692
    params:
      params.yaml:
        data.extract_path: data/raw
        model.num_classes: 46
        train.alpha: 0.2078451089181085
        train.batch_size: 32
        train.epochs: 2
        train.lr: 0.0003682779964048965
        train.temperature: 5.971135416355251
    outs:
    - path: models/best_student.pth
      hash: md5
      md5: 0a73b0852aec4ed6c99ab7769e0cc30e
      size: 9373003
  convert:
    cmd: python src/conversion/convert.py
    deps:
    - path: models/best_student.pth
      hash: md5
      md5: 0a73b0852aec4ed6c99ab7769e0cc30e
      size: 9373003
    - path: src/conversion/convert.py
      hash: md5
      md5: 84e477943c537162f8c0bc8fbde64d6c
      size: 9492
    params:
      params.yaml:
        data.extract_path: data/raw
        evaluation.min_accuracy: 85.0
    outs:
    - path: models/student_quant_int8.tflite
      hash: md5
      md5: 42af364b81301d497ef4cd1254fb446e
      size: 2770392
  enroll:
    cmd: python src/enrollment/enroll.py
    deps:
    - path: data/raw
      hash: md5
      md5: fe2b3cdaaa4dec0f52e84ec41525004d.dir
      size: 156502338
      nfiles: 19718
    - path: models/student_quant_int8.tflite
      hash: md5
      md5: 42af364b81301d497ef4cd1254fb446e
      size: 2770392
    - path: src/enrollment/enroll.py
      hash: md5
      md5: 4cb4330ad3bf7a8aebe0e5876d8dfbad
      size: 4898
    params:
      params.yaml:
        enrollment.s3_prefix: production/edge-models/v1/
    outs:
    - path: models/labels.json
      hash: md5
      md5: 2d431afa2ec2451df8af92f6c0d1b9b2
      size: 28682
    - path: models/pill_db.index
      hash: md5
      md5: 573aff2d307de5bb7257391030bb44bf
      size: 253965
  validate:
    cmd: python src/validate.py
    deps:
    - path: data/raw/pills_dataset_resnet/test
      hash: md5
      md5: f6d85b333af7f2f1b5815bb72f493563.dir
      size: 23772179
      nfiles: 1510
    - path: models/pill_db.index
      hash: md5
      md5: c95706bfbd1e888b15f397026796dbe0
      size: 253965
    - path: models/student_quant_int8.tflite
      hash: md5
      md5: e64ae75a8966ce99d96faa9f73935fd4
      size: 2770392
    - path: src/validate.py
      hash: md5
      md5: 118d2fdc9cd2cc08c2bd97d63f9a03cc
      size: 5132
    outs:
    - path: metrics.json
      hash: md5
      md5: a33e41c1dd341ba7ca1e9f18cec253cc
      size: 38
  prepare:
    cmd: python src/prepare.py
    deps:
    - path: data/pills_dataset_resnet.zip
      hash: md5
      md5: afc658f9360f9f008a3bda6ecf8fdf52
      size: 147818896
    - path: src/prepare.py
      hash: md5
      md5: c91d9e12265d12392a7e3ee83e23913e
      size: 910
    outs:
    - path: data/raw
      hash: md5
      md5: fe2b3cdaaa4dec0f52e84ec41525004d.dir
      size: 156502338
      nfiles: 19718
